generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id           String         @id @default(cuid())
  email        String         @unique
  name         String?
  image        String?
  createdAt    DateTime       @default(now())
  updatedAt    DateTime       @updatedAt
  purchases    Purchase[]
  userProgress UserProgress[]
}

model Category {
  id          String   @id @default(cuid())
  name        String   @unique
  description String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  courses     Course[]
}

model Course {
  id          String     @id @default(cuid())
  title       String
  description String?
  imageUrl    String?
  price       Float      @default(0)
  isPublished Boolean    @default(false)
  categoryId  String
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
  chapters    Chapter[]
  category    Category   @relation(fields: [categoryId], references: [id])
  purchases   Purchase[]
}

model Chapter {
  id          String   @id @default(cuid())
  title       String
  position    Int
  isPublished Boolean  @default(false)
  courseId    String
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  course      Course   @relation(fields: [courseId], references: [id], onDelete: Cascade)
  lessons     Lesson[]

  @@unique([courseId, position])
}

model Lesson {
  id            String         @id @default(cuid())
  title         String
  videoUrl      String?
  position      Int
  isFreePreview Boolean        @default(false)
  isPublished   Boolean        @default(false)
  chapterId     String
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt
  chapter       Chapter        @relation(fields: [chapterId], references: [id], onDelete: Cascade)
  userProgress  UserProgress[]

  @@unique([chapterId, position])
}

model Purchase {
  id        String   @id @default(cuid())
  userId    String
  courseId  String
  createdAt DateTime @default(now())
  course    Course   @relation(fields: [courseId], references: [id], onDelete: Cascade)
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, courseId])
}

model UserProgress {
  id          String   @id @default(cuid())
  userId      String
  lessonId    String
  isCompleted Boolean  @default(false)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  lesson      Lesson   @relation(fields: [lessonId], references: [id], onDelete: Cascade)
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, lessonId])
}

// =====================================================
// WHITE LABEL - DESABILITADO (2026-01-23)
// Modelo preservado para reativação futura
// Ver: .context/archived/white-label-reativacao.md
// =====================================================
// tenant_settings model removed — reactivate from .context/archived if needed

// =====================================================
// MODELOS LEGADOS REMOVIDOS (2026-02-18)
// Os modelos abaixo (attachments, comments, courses,
// lessons, modules, sessions, user_progress, users)
// usavam IDs inteiros e foram substituídos pelos
// modelos acima com IDs CUID.
// As tabelas podem ainda existir no banco de dados
// de produção mas não são utilizadas pelo código.
// =====================================================
